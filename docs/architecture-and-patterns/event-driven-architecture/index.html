<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-architecture-and-patterns/event-driven-architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Event-Driven Architecture | EndToEndLabCR </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://endtoendlabcr.github.io/documentation-docs-markdown/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://endtoendlabcr.github.io/documentation-docs-markdown/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://endtoendlabcr.github.io/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Event-Driven Architecture | EndToEndLabCR "><meta data-rh="true" name="description" content="This file covers event-driven architecture patterns, implementation strategies, and best practices."><meta data-rh="true" property="og:description" content="This file covers event-driven architecture patterns, implementation strategies, and best practices."><link data-rh="true" rel="icon" href="/documentation-docs-markdown/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://endtoendlabcr.github.io/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture"><link data-rh="true" rel="alternate" href="https://endtoendlabcr.github.io/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://endtoendlabcr.github.io/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Architecture and Patterns","item":"https://endtoendlabcr.github.io/documentation-docs-markdown/docs/category/architecture-and-patterns"},{"@type":"ListItem","position":2,"name":"Event-Driven Architecture","item":"https://endtoendlabcr.github.io/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture"}]}</script><link rel="stylesheet" href="/documentation-docs-markdown/assets/css/styles.8de23054.css">
<script src="/documentation-docs-markdown/assets/js/runtime~main.4bdefe0f.js" defer="defer"></script>
<script src="/documentation-docs-markdown/assets/js/main.8a53750a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentation-docs-markdown/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation-docs-markdown/"><div class="navbar__logo"><img src="/documentation-docs-markdown/img/logo.svg" alt="EndToEndLabCR Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation-docs-markdown/img/logo.svg" alt="EndToEndLabCR Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">EndToEndLabCR</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documentation-docs-markdown/docs/intro">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/EndToEndLabCR/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation-docs-markdown/docs/intro"><span title="Welcome" class="linkLabel_WmDU">Welcome</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/introduction"><span title="Introduction" class="categoryLinkLabel_W154">Introduction</span></a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/tutorial---extras"><span title="Tutorial - Extras" class="categoryLinkLabel_W154">Tutorial - Extras</span></a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/tech-stack"><span title="Tech Stack" class="categoryLinkLabel_W154">Tech Stack</span></a><button aria-label="Expand sidebar category &#x27;Tech Stack&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/organizational-best-practices"><span title="Organizational Best Practices" class="categoryLinkLabel_W154">Organizational Best Practices</span></a><button aria-label="Expand sidebar category &#x27;Organizational Best Practices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/faq-and-troubleshooting"><span title="FAQ and Troubleshooting" class="categoryLinkLabel_W154">FAQ and Troubleshooting</span></a><button aria-label="Expand sidebar category &#x27;FAQ and Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/projects"><span title="Projects" class="categoryLinkLabel_W154">Projects</span></a><button aria-label="Expand sidebar category &#x27;Projects&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/documentation-docs-markdown/docs/category/architecture-and-patterns"><span title="Architecture and Patterns" class="categoryLinkLabel_W154">Architecture and Patterns</span></a><button aria-label="Collapse sidebar category &#x27;Architecture and Patterns&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-docs-markdown/docs/architecture-and-patterns/architectural-styles"><span title="Architectural Styles" class="linkLabel_WmDU">Architectural Styles</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-docs-markdown/docs/architecture-and-patterns/design-patterns-in-python"><span title="Design Patterns in Python" class="linkLabel_WmDU">Design Patterns in Python</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation-docs-markdown/docs/architecture-and-patterns/event-driven-architecture"><span title="Event-Driven Architecture" class="linkLabel_WmDU">Event-Driven Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-docs-markdown/docs/architecture-and-patterns/microservices-architecture"><span title="Microservices Architecture" class="linkLabel_WmDU">Microservices Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation-docs-markdown/docs/architecture-and-patterns/python-api-project-tree"><span title="python-api-project-tree" class="linkLabel_WmDU">python-api-project-tree</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/documentation-docs-markdown/docs/category/install-and-setup"><span title="Install and Setup" class="categoryLinkLabel_W154">Install and Setup</span></a><button aria-label="Expand sidebar category &#x27;Install and Setup&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation-docs-markdown/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentation-docs-markdown/docs/category/architecture-and-patterns"><span>Architecture and Patterns</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Event-Driven Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Event-Driven Architecture</h1></header>
<p>This file covers event-driven architecture patterns, implementation strategies, and best practices.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-concepts">Core Concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core Concepts" title="Direct link to Core Concepts" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="events-vs-messages">Events vs Messages<a href="#events-vs-messages" class="hash-link" aria-label="Direct link to Events vs Messages" title="Direct link to Events vs Messages" translate="no">​</a></h3>
<ul>
<li class=""><strong>Events</strong>: Something that happened in the past (immutable)</li>
<li class=""><strong>Commands</strong>: Instructions to do something (imperative)</li>
<li class=""><strong>Queries</strong>: Requests for information (interrogative)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-types">Event Types<a href="#event-types" class="hash-link" aria-label="Direct link to Event Types" title="Direct link to Event Types" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Domain Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderCreatedEvent extends DomainEvent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final BigDecimal totalAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final LocalDateTime createdAt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OrderCreatedEvent(String orderId, String customerId, BigDecimal totalAmount) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.orderId = orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.customerId = customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.totalAmount = totalAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.createdAt = LocalDateTime.now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Getters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Integration Event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomerRegisteredEvent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String email;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String firstName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String lastName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Constructor and getters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-sourcing">Event Sourcing<a href="#event-sourcing" class="hash-link" aria-label="Direct link to Event Sourcing" title="Direct link to Event Sourcing" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Event Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Table(name = &quot;event_store&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EventStoreEntry {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;stream_id&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String streamId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;event_type&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String eventType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;event_data&quot;, columnDefinition = &quot;TEXT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String eventData;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;event_version&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long version;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;timestamp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LocalDateTime timestamp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Constructors, getters, setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Event Store Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EventStore {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final EventStoreRepository repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ObjectMapper objectMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void saveEvents(String streamId, List&lt;DomainEvent&gt; events, Long expectedVersion) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Long currentVersion = getLastVersion(streamId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!Objects.equals(currentVersion, expectedVersion)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new ConcurrencyException(&quot;Stream has been modified&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; events.size(); i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DomainEvent event = events.get(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            EventStoreEntry entry = new EventStoreEntry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entry.setStreamId(streamId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entry.setEventType(event.getClass().getSimpleName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entry.setEventData(serialize(event));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entry.setVersion(currentVersion + i + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            entry.setTimestamp(LocalDateTime.now());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            repository.save(entry);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;DomainEvent&gt; getEvents(String streamId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;EventStoreEntry&gt; entries = repository.findByStreamIdOrderByVersion(streamId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return entries.stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(this::deserialize)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;DomainEvent&gt; getEvents(String streamId, Long fromVersion) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;EventStoreEntry&gt; entries = repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .findByStreamIdAndVersionGreaterThanOrderByVersion(streamId, fromVersion);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return entries.stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(this::deserialize)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Aggregate Root with Event Sourcing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public abstract class AggregateRoot {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long version;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final List&lt;DomainEvent&gt; uncommittedEvents = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void applyEvent(DomainEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applyChange(event, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void markEventsAsCommitted() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uncommittedEvents.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void loadFromHistory(List&lt;DomainEvent&gt; history) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (DomainEvent event : history) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            applyChange(event, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            version++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void applyChange(DomainEvent event, boolean isNew) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Apply event to current state using reflection or visitor pattern</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        apply(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isNew) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            uncommittedEvents.add(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected abstract void apply(DomainEvent event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;DomainEvent&gt; getUncommittedEvents() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Collections.unmodifiableList(uncommittedEvents);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Getters and setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Order Aggregate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Order extends AggregateRoot {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private OrderStatus status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;OrderItem&gt; items;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BigDecimal totalAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Order() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Default constructor for framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Order(String customerId, List&lt;OrderItem&gt; items) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setId(UUID.randomUUID().toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.customerId = customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.items = new ArrayList&lt;&gt;(items);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.status = OrderStatus.DRAFT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.totalAmount = calculateTotal();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applyEvent(new OrderCreatedEvent(getId(), customerId, totalAmount));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void confirm() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (status != OrderStatus.DRAFT) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalStateException(&quot;Only draft orders can be confirmed&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.status = OrderStatus.CONFIRMED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        applyEvent(new OrderConfirmedEvent(getId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void apply(DomainEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (event instanceof OrderCreatedEvent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            apply((OrderCreatedEvent) event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (event instanceof OrderConfirmedEvent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            apply((OrderConfirmedEvent) event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle other events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void apply(OrderCreatedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setId(event.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.customerId = event.getCustomerId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.totalAmount = event.getTotalAmount();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.status = OrderStatus.DRAFT;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void apply(OrderConfirmedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.status = OrderStatus.CONFIRMED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="cqrs-command-query-responsibility-segregation">CQRS (Command Query Responsibility Segregation)<a href="#cqrs-command-query-responsibility-segregation" class="hash-link" aria-label="Direct link to CQRS (Command Query Responsibility Segregation)" title="Direct link to CQRS (Command Query Responsibility Segregation)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="command-side">Command Side<a href="#command-side" class="hash-link" aria-label="Direct link to Command Side" title="Direct link to Command Side" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface Command {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String getAggregateId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CreateOrderCommand implements Command {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final String customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final List&lt;OrderItemData&gt; items;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Constructor and getters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getAggregateId() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Command Handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderCommandHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final EventStore eventStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @CommandHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handle(CreateOrderCommand command) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;OrderItem&gt; items = command.getItems().stream()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(data -&gt; new OrderItem(data.getProductId(), data.getQuantity(), data.getPrice()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Order order = new Order(command.getCustomerId(), items);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eventStore.saveEvents(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getUncommittedEvents(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getVersion()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order.markEventsAsCommitted();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @CommandHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handle(ConfirmOrderCommand command) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;DomainEvent&gt; events = eventStore.getEvents(command.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Order order = new Order();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order.loadFromHistory(events);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        order.confirm();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eventStore.saveEvents(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getId(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getUncommittedEvents(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.getVersion()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-side">Query Side<a href="#query-side" class="hash-link" aria-label="Direct link to Query Side" title="Direct link to Query Side" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Read Models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Table(name = &quot;order_view&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderView {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String orderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String customerId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String customerName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BigDecimal totalAmount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LocalDateTime createdAt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LocalDateTime confirmedAt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Constructors, getters, setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Projection Handlers (Event Handlers for Read Side)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderProjectionHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final OrderViewRepository repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(OrderCreatedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OrderView view = new OrderView();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setOrderId(event.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setCustomerId(event.getCustomerId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setTotalAmount(event.getTotalAmount());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setStatus(&quot;DRAFT&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setCreatedAt(event.getOccurredOn());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repository.save(view);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(OrderConfirmedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OrderView view = repository.findById(event.getOrderId())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .orElseThrow(() -&gt; new IllegalStateException(&quot;Order view not found&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setStatus(&quot;CONFIRMED&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view.setConfirmedAt(event.getOccurredOn());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repository.save(view);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(CustomerRegisteredEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Update customer name in all order views</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;OrderView&gt; orders = repository.findByCustomerId(event.getCustomerId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        orders.forEach(order -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            order.setCustomerName(event.getFirstName() + &quot; &quot; + event.getLastName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            repository.save(order);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Query Handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderQueryHandler {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final OrderViewRepository repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Optional&lt;OrderView&gt; findById(String orderId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return repository.findById(orderId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;OrderView&gt; findByCustomerId(String customerId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return repository.findByCustomerId(customerId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Page&lt;OrderView&gt; findByStatus(String status, Pageable pageable) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return repository.findByStatus(status, pageable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-streaming-with-kafka">Event Streaming with Kafka<a href="#event-streaming-with-kafka" class="hash-link" aria-label="Direct link to Event Streaming with Kafka" title="Direct link to Event Streaming with Kafka" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="producer-configuration">Producer Configuration<a href="#producer-configuration" class="hash-link" aria-label="Direct link to Producer Configuration" title="Direct link to Producer Configuration" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class KafkaProducerConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProducerFactory&lt;String, Object&gt; producerFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; configProps = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.ACKS_CONFIG, &quot;all&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.RETRIES_CONFIG, 3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        configProps.put(ProducerConfig.LINGER_MS_CONFIG, 5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DefaultKafkaProducerFactory&lt;&gt;(configProps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public KafkaTemplate&lt;String, Object&gt; kafkaTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new KafkaTemplate&lt;&gt;(producerFactory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Event Publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EventPublisher {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final KafkaTemplate&lt;String, Object&gt; kafkaTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void publish(DomainEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String topic = getTopicName(event);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String key = event.getAggregateId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kafkaTemplate.send(topic, key, event)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addCallback(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                result -&gt; log.info(&quot;Event published successfully: {}&quot;, event),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                failure -&gt; log.error(&quot;Failed to publish event: {}&quot;, event, failure)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String getTopicName(DomainEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;events.&quot; + event.getClass().getSimpleName().toLowerCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="consumer-configuration">Consumer Configuration<a href="#consumer-configuration" class="hash-link" aria-label="Direct link to Consumer Configuration" title="Direct link to Consumer Configuration" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableKafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class KafkaConsumerConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ConsumerFactory&lt;String, Object&gt; consumerFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; props = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, &quot;localhost:9092&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(ConsumerConfig.GROUP_ID_CONFIG, &quot;order-service&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        props.put(JsonDeserializer.TRUSTED_PACKAGES, &quot;*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DefaultKafkaConsumerFactory&lt;&gt;(props);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; kafkaListenerContainerFactory() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConcurrentKafkaListenerContainerFactory&lt;String, Object&gt; factory =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new ConcurrentKafkaListenerContainerFactory&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setConsumerFactory(consumerFactory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setConcurrency(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setRetryTemplate(retryTemplate());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setErrorHandler(new SeekToCurrentErrorHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return factory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RetryTemplate retryTemplate() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RetryTemplate retryTemplate = new RetryTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backOffPolicy.setBackOffPeriod(1000L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retryTemplate.setBackOffPolicy(backOffPolicy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retryPolicy.setMaxAttempts(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        retryTemplate.setRetryPolicy(retryPolicy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return retryTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Event Listeners</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderEventListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @KafkaListener(topics = &quot;events.customerwelcomed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleCustomerWelcomed(CustomerWelcomedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;Customer welcomed: {}&quot;, event.getCustomerId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Send welcome email or perform other actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @KafkaListener(topics = &quot;events.inventoryreserved&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleInventoryReserved(InventoryReservedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;Inventory reserved for order: {}&quot;, event.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Continue with order processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="saga-pattern-for-process-management">Saga Pattern for Process Management<a href="#saga-pattern-for-process-management" class="hash-link" aria-label="Direct link to Saga Pattern for Process Management" title="Direct link to Saga Pattern for Process Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="orchestration-based-saga">Orchestration-based Saga<a href="#orchestration-based-saga" class="hash-link" aria-label="Direct link to Orchestration-based Saga" title="Direct link to Orchestration-based Saga" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderProcessSaga {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final InventoryService inventoryService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final PaymentService paymentService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final NotificationService notificationService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @SagaOrchestrationStart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void processOrder(OrderCreatedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SagaTransaction saga = SagaTransaction.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .step(&quot;reserve-inventory&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .action(() -&gt; inventoryService.reserve(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compensation(() -&gt; inventoryService.release(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .step(&quot;process-payment&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .action(() -&gt; paymentService.charge(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compensation(() -&gt; paymentService.refund(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .step(&quot;send-confirmation&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .action(() -&gt; notificationService.sendConfirmation(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .compensation(() -&gt; notificationService.sendCancellation(event.getOrderId()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        saga.execute();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="choreography-based-saga">Choreography-based Saga<a href="#choreography-based-saga" class="hash-link" aria-label="Direct link to Choreography-based Saga" title="Direct link to Choreography-based Saga" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Each service handles its own compensation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class InventoryService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(OrderCreatedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reserve(event.getOrderId(), event.getItems());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eventPublisher.publish(new InventoryReservedEvent(event.getOrderId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (InsufficientInventoryException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eventPublisher.publish(new InventoryReservationFailedEvent(event.getOrderId(), e.getMessage()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(OrderCancelledEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        release(event.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eventPublisher.publish(new InventoryReleasedEvent(event.getOrderId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class PaymentService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void on(InventoryReservedEvent event) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            charge(event.getOrderId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eventPublisher.publish(new PaymentProcessedEvent(event.getOrderId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (PaymentException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eventPublisher.publish(new PaymentFailedEvent(event.getOrderId(), e.getMessage()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Trigger compensation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eventPublisher.publish(new OrderCancelledEvent(event.getOrderId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-store-snapshots">Event Store Snapshots<a href="#event-store-snapshots" class="hash-link" aria-label="Direct link to Event Store Snapshots" title="Direct link to Event Store Snapshots" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="snapshot-implementation">Snapshot Implementation<a href="#snapshot-implementation" class="hash-link" aria-label="Direct link to Snapshot Implementation" title="Direct link to Snapshot Implementation" translate="no">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Entity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Table(name = &quot;snapshots&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class Snapshot {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String aggregateId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;aggregate_type&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String aggregateType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;data&quot;, columnDefinition = &quot;TEXT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;version&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long version;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Column(name = &quot;timestamp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LocalDateTime timestamp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Constructors, getters, setters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SnapshotStore {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final SnapshotRepository repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ObjectMapper objectMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void saveSnapshot(AggregateRoot aggregate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Snapshot snapshot = new Snapshot();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snapshot.setAggregateId(aggregate.getId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snapshot.setAggregateType(aggregate.getClass().getSimpleName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snapshot.setData(serialize(aggregate));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snapshot.setVersion(aggregate.getVersion());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snapshot.setTimestamp(LocalDateTime.now());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repository.save(snapshot);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T extends AggregateRoot&gt; Optional&lt;T&gt; loadSnapshot(String aggregateId, Class&lt;T&gt; aggregateType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return repository.findByAggregateIdAndAggregateType(aggregateId, aggregateType.getSimpleName())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(snapshot -&gt; deserialize(snapshot.getData(), aggregateType));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Loading with snapshots</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AggregateRepository&lt;T extends AggregateRoot&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final EventStore eventStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final SnapshotStore snapshotStore;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public T load(String aggregateId, Class&lt;T&gt; aggregateType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Try to load from snapshot first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Optional&lt;T&gt; snapshot = snapshotStore.loadSnapshot(aggregateId, aggregateType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (snapshot.isPresent()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            T aggregate = snapshot.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Load events after snapshot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;DomainEvent&gt; events = eventStore.getEvents(aggregateId, aggregate.getVersion());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            aggregate.loadFromHistory(events);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return aggregate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Load all events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;DomainEvent&gt; events = eventStore.getEvents(aggregateId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            T aggregate = createInstance(aggregateType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            aggregate.loadFromHistory(events);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return aggregate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-design">Event Design<a href="#event-design" class="hash-link" aria-label="Direct link to Event Design" title="Direct link to Event Design" translate="no">​</a></h3>
<ol>
<li class=""><strong>Immutable Events</strong>: Events should never change</li>
<li class=""><strong>Rich Events</strong>: Include enough data to avoid querying</li>
<li class=""><strong>Business Language</strong>: Use domain terminology</li>
<li class=""><strong>Versioning</strong>: Plan for event schema evolution</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-considerations">Performance Considerations<a href="#performance-considerations" class="hash-link" aria-label="Direct link to Performance Considerations" title="Direct link to Performance Considerations" translate="no">​</a></h3>
<ol>
<li class=""><strong>Snapshots</strong>: For aggregates with many events</li>
<li class=""><strong>Projections</strong>: Pre-computed views for queries</li>
<li class=""><strong>Caching</strong>: Cache frequently accessed data</li>
<li class=""><strong>Async Processing</strong>: Handle events asynchronously when possible</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling">Error Handling<a href="#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling" translate="no">​</a></h3>
<ol>
<li class=""><strong>Idempotency</strong>: Handle duplicate events gracefully</li>
<li class=""><strong>Dead Letter Queues</strong>: For failed events</li>
<li class=""><strong>Monitoring</strong>: Track event processing metrics</li>
<li class=""><strong>Compensation</strong>: Plan for failure scenarios</li>
</ol>
<p>Event-driven architecture enables scalable, resilient systems but requires careful design and operational practices.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/EndToEndLabCR/docs/architecture-and-patterns/event-driven-architecture.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation-docs-markdown/docs/architecture-and-patterns/design-patterns-in-python"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Design Patterns in Python</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation-docs-markdown/docs/architecture-and-patterns/microservices-architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Microservices Architecture</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core Concepts</a><ul><li><a href="#events-vs-messages" class="table-of-contents__link toc-highlight">Events vs Messages</a></li><li><a href="#event-types" class="table-of-contents__link toc-highlight">Event Types</a></li></ul></li><li><a href="#event-sourcing" class="table-of-contents__link toc-highlight">Event Sourcing</a><ul><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li></ul></li><li><a href="#cqrs-command-query-responsibility-segregation" class="table-of-contents__link toc-highlight">CQRS (Command Query Responsibility Segregation)</a><ul><li><a href="#command-side" class="table-of-contents__link toc-highlight">Command Side</a></li><li><a href="#query-side" class="table-of-contents__link toc-highlight">Query Side</a></li></ul></li><li><a href="#event-streaming-with-kafka" class="table-of-contents__link toc-highlight">Event Streaming with Kafka</a><ul><li><a href="#producer-configuration" class="table-of-contents__link toc-highlight">Producer Configuration</a></li><li><a href="#consumer-configuration" class="table-of-contents__link toc-highlight">Consumer Configuration</a></li></ul></li><li><a href="#saga-pattern-for-process-management" class="table-of-contents__link toc-highlight">Saga Pattern for Process Management</a><ul><li><a href="#orchestration-based-saga" class="table-of-contents__link toc-highlight">Orchestration-based Saga</a></li><li><a href="#choreography-based-saga" class="table-of-contents__link toc-highlight">Choreography-based Saga</a></li></ul></li><li><a href="#event-store-snapshots" class="table-of-contents__link toc-highlight">Event Store Snapshots</a><ul><li><a href="#snapshot-implementation" class="table-of-contents__link toc-highlight">Snapshot Implementation</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#event-design" class="table-of-contents__link toc-highlight">Event Design</a></li><li><a href="#performance-considerations" class="table-of-contents__link toc-highlight">Performance Considerations</a></li><li><a href="#error-handling" class="table-of-contents__link toc-highlight">Error Handling</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/documentation-docs-markdown/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/nGzHazdd" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@endtoendlabcr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/EndToEndLabCR" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 EndToEndLabCR, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>
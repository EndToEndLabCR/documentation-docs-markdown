# Clean Architecture FastAPI + CLI + Kafka Project Structure

```
user-management-api/
â”‚
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ requirements-cli.txt                          # CLI-specific dependencies
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml                            # Include Kafka services
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Dockerfile.cli                                # Separate CLI container
â”‚
â”œâ”€â”€ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                                    # ğŸ›ï¸ DOMAIN LAYER (Core Business Logic)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ user.py                           # Domain entities with business rules
â”‚   â”‚   â”œâ”€â”€ exceptions/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ user_exceptions.py                # Domain-specific exceptions
â”‚   â”‚   â””â”€â”€ events/                               # ğŸ†• Domain events
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py                           # Base domain event
â”‚   â”‚       â””â”€â”€ user_events.py                    # User domain events
â”‚   â”‚
â”‚   â”œâ”€â”€ application/                               # ğŸ¯ APPLICATION LAYER (Use Cases & Business Logic)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dtos/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_dtos.py                      # Data Transfer Objects
â”‚   â”‚   â”‚   â””â”€â”€ message_dtos.py                   # ğŸ†• Message/Event DTOs
â”‚   â”‚   â”œâ”€â”€ interfaces/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user_repository.py            # Repository abstractions
â”‚   â”‚   â”‚   â””â”€â”€ messaging/                        # ğŸ†• Messaging interfaces
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ event_publisher.py            # Event publishing interface
â”‚   â”‚   â”‚       â””â”€â”€ message_handler.py            # Message handling interface
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ user_service.py                   # Application services
â”‚   â”‚       â””â”€â”€ event_service.py                  # ğŸ†• Event handling service
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/                            # ğŸ”§ INFRASTRUCTURE LAYER (External Concerns)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py                           # SQLAlchemy base
â”‚   â”‚   â”‚   â”œâ”€â”€ session.py                        # Database session
â”‚   â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ user_model.py                 # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ user_repository.py                # Repository implementations
â”‚   â”‚   â”œâ”€â”€ messaging/                            # ğŸ†• Kafka & Messaging
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ kafka/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config.py                     # Kafka configuration
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ producer.py                   # Kafka producer
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ consumer.py                   # Kafka consumer
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ topics.py                     # Topic definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ publishers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user_event_publisher.py       # User event publisher
â”‚   â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ user_message_handler.py       # User message handler
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ settings.py                       # Application configuration
â”‚   â”‚   â””â”€â”€ dependencies.py                       # Dependency injection
â”‚   â”‚
â”‚   â”œâ”€â”€ presentation/                              # ğŸŒ PRESENTATION LAYER (API Controllers)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api/                                  # ğŸ”„ Renamed for clarity
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ user_controller.py            # FastAPI controllers
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ error_handler.py              # Global exception handling
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cors.py                       # CORS configuration
â”‚   â”‚   â”‚   â””â”€â”€ schemas/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ responses.py                  # API response schemas
â”‚   â”‚   â””â”€â”€ main.py                               # FastAPI app entry point
â”‚   â”‚
â”‚   â”œâ”€â”€ cli/                                      # ğŸ–¥ï¸ CLI LAYER (Command Line Interface)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ user_commands.py                  # User CLI commands
â”‚   â”‚   â”‚   â””â”€â”€ kafka_commands.py                 # Kafka CLI commands
â”‚   â”‚   â”œâ”€â”€ formatters/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ table_formatter.py                # Table output formatting
â”‚   â”‚   â”‚   â””â”€â”€ json_formatter.py                 # JSON output formatting
â”‚   â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ input_validators.py               # CLI input validation
â”‚   â”‚   â””â”€â”€ main.py                               # CLI app entry point
â”‚   â”‚
â”‚   â””â”€â”€ messaging/                                # ğŸ”„ MESSAGING LAYER (Event-Driven Architecture)
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ consumers/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ user_consumer.py                  # User event consumer
â”‚       â”‚   â””â”€â”€ base_consumer.py                  # Base consumer class
â”‚       â”œâ”€â”€ processors/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ user_event_processor.py           # Event processing logic
â”‚       â””â”€â”€ main.py                               # Message consumer entry point
â”‚
â”œâ”€â”€ tests/                                         # ğŸ§ª TEST LAYER
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ test_user.py
â”‚   â”‚   â”‚   â””â”€â”€ events/                           # ğŸ†• Domain events tests
â”‚   â”‚   â”‚       â””â”€â”€ test_user_events.py
â”‚   â”‚   â”œâ”€â”€ application/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚   â”‚       â”œâ”€â”€ test_user_service.py
â”‚   â”‚   â”‚       â””â”€â”€ test_event_service.py         # ğŸ†• Event service tests
â”‚   â”‚   â”œâ”€â”€ infrastructure/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ test_user_repository.py
â”‚   â”‚   â”‚   â””â”€â”€ messaging/                        # ğŸ†• Messaging tests
â”‚   â”‚   â”‚       â”œâ”€â”€ test_kafka_producer.py
â”‚   â”‚   â”‚       â””â”€â”€ test_kafka_consumer.py
â”‚   â”‚   â”œâ”€â”€ cli/                                  # ğŸ†• CLI tests
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”‚   â”‚       â””â”€â”€ test_user_commands.py
â”‚   â”‚   â””â”€â”€ messaging/                            # ğŸ†• Messaging layer tests
â”‚   â”‚       â””â”€â”€ test_user_consumer.py
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_user_endpoints.py
â”‚   â”‚   â”œâ”€â”€ test_kafka_integration.py             # ğŸ†• Kafka integration tests
â”‚   â”‚   â””â”€â”€ test_cli_integration.py               # ğŸ†• CLI integration tests
â”‚   â””â”€â”€ e2e/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ test_user_flow.py
â”‚       â””â”€â”€ test_event_flow.py                    # ğŸ†• Event-driven flow tests
â”‚
â”œâ”€â”€ migrations/                                    # ğŸ“¦ DATABASE MIGRATIONS
â”‚   â”œâ”€â”€ versions/
â”‚   â”œâ”€â”€ alembic.ini
â”‚   â”œâ”€â”€ env.py
â”‚   â””â”€â”€ script.py.mako
â”‚
â”œâ”€â”€ docs/                                          # ğŸ“š DOCUMENTATION
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ api.md
â”‚   â”œâ”€â”€ cli.md                                    # ğŸ†• CLI documentation
â”‚   â”œâ”€â”€ kafka.md                                  # ğŸ†• Kafka documentation
â”‚   â””â”€â”€ deployment.md
â”‚
â”œâ”€â”€ scripts/                                       # ğŸ”¨ UTILITY SCRIPTS
â”‚   â”œâ”€â”€ start-api.sh
â”‚   â”œâ”€â”€ start-cli.sh                              # ğŸ†• CLI startup script
â”‚   â”œâ”€â”€ start-consumers.sh                        # ğŸ†• Kafka consumers
â”‚   â”œâ”€â”€ test.sh
â”‚   â””â”€â”€ migrate.sh
â”‚
â”œâ”€â”€ docker/                                        # ğŸ³ DOCKER CONFIGURATIONS
â”‚   â”œâ”€â”€ api.Dockerfile
â”‚   â”œâ”€â”€ cli.Dockerfile                            # ğŸ†• CLI container
â”‚   â”œâ”€â”€ consumer.Dockerfile                       # ğŸ†• Message consumer container
â”‚   â””â”€â”€ kafka/                                    # ğŸ†• Kafka setup
â”‚       â”œâ”€â”€ docker-compose.kafka.yml
â”‚       â””â”€â”€ kafka-setup.sh
â”‚
â””â”€â”€ .github/                                       # ğŸš€ CI/CD & GitHub Configuration
    â”œâ”€â”€ workflows/
    â”‚   â”œâ”€â”€ api-ci.yml
    ï¿½ï¿½   â”œâ”€â”€ cli-ci.yml                            # ğŸ†• CLI CI/CD
    â”‚   â”œâ”€â”€ kafka-ci.yml                          # ğŸ†• Kafka integration CI
    â”‚   â””â”€â”€ integration-tests.yml
    â””â”€â”€ ISSUE_TEMPLATE/
        â”œâ”€â”€ bug_report.md
        â””â”€â”€ feature_request.md
```

## ğŸ—ï¸ **Architecture Layers (Updated)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¥ï¸ CLI LAYER        ğŸŒ PRESENTATION LAYER   ğŸ”„ MESSAGING LAYER  â”‚ â† Level 3 (Outer)
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                ğŸ”§ INFRASTRUCTURE LAYER                       â”‚ â”‚ â† Level 3 (Outer)  
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚              ğŸ¯ APPLICATION LAYER                       â”‚  â”‚ â”‚ â† Level 2 (Middle)
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚             ğŸ›ï¸ DOMAIN LAYER                        â”‚â”‚  â”‚ â”‚ â† Level 1 (Core)
â”‚  â”‚  â”‚  â”‚  â€¢ Entities     â€¢ Events     â€¢ Exceptions          â”‚â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Services   â€¢ DTOs   â€¢ Interfaces                    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚  â€¢ Repositories  â€¢ Messaging  â€¢ Database  â€¢ Config            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â€¢ API Routes    â€¢ CLI Commands    â€¢ Event Consumers               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
